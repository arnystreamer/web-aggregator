<div>
  <h2>Data analysis extended</h2>
</div>

<div class="actions-panel">
  <button color="accent" mat-flat-button [routerLink]="['..']">
    <mat-icon>arrow_back</mat-icon>
    Back
  </button>
</div>

<div class="actions-panel form-inline-container" *ngIf="filterForm">
  <form [formGroup]="filterForm">
    <mat-form-field class="field">
      <mat-label>Salary type</mat-label>
      <mat-select name="salaryTypeId" formControlName="salaryTypeId">
        <mat-option *ngFor="let salaryType of salaryTypes" [value]="salaryType.id">{{salaryType.name}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="field-shorter">
      <mat-label>Manual salary</mat-label>
      <input matInput name="manualSalary" formControlName="manualSalary">
    </mat-form-field>

    <mat-form-field class="field-shorter">
      <mat-label>Multiplicator</mat-label>
      <input matInput name="salaryMultiplicator" formControlName="salaryMultiplicator">
    </mat-form-field>

    <div class="splitter">
      &nbsp;
    </div>

    <mat-form-field class="field-long">
      <mat-label>Sorting</mat-label>
      <mat-select name="sortingFunction" formControlName="sortingFunction">
        @for(sortingFunction of sortingFunctions; track $index)
        {
          <mat-option [value]="sortingFunction.id">{{sortingFunction.name}}</mat-option>
        }

      </mat-select>
    </mat-form-field>

    <mat-form-field class="field-short">
      <mat-label>Sort direction</mat-label>
      <mat-select name="sortAscending" formControlName="sortAscending">
        <mat-option [value]="true">Ascending</mat-option>
        <mat-option [value]="false">Descending</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-flat-button (click)="getReport()">Rebuild</button>
  </form>
</div>

<div *ngIf="reportResult">

  <table>
    <tr>
      <th>City</th>
      <th>Fact annual salary</th>
      <th>Expenses per month</th>
      <th>Desirable salary</th>
      <th>Big purchases</th>
    </tr>
    @for(city of this.reportResult.items; track $index)
    {
      <tr>
        <td>
          {{$index + 1}} of {{this.reportResult.count}}<br/>
          {{city.name}}, {{city.region}}<br/>
          {{city.country}}
          @if (city.countryCode)
          {
            <img src="https://flagsapi.com/{{city.countryCode}}/flat/16.png" />
          }
        </td>
        <td>
          <ul>
            <li>Avg net/gross: <wa-profit-taxable [profit]="city.salaryData.averageSalary" [currencyCode]="city.currencyCode" /></li>
            <li>P25 net/gross: <wa-profit-taxable [profit]="city.salaryData.p25Salary" [currencyCode]="city.currencyCode" /></li>
            <li>P75 net/gross: <wa-profit-taxable [profit]="city.salaryData.p75Salary" [currencyCode]="city.currencyCode" /></li>
            <li>Selected: <wa-profit-taxable [profit]="city.selectedSalary" [currencyCode]="city.currencyCode" /></li>
          </ul>
        </td>
        <td>
          <ul>
            <li *ngIf="city.hasFreeApartment"><b style="color: orange;">Free apt. applied</b></li>
            <li>Minimal: <wa-cost-fact [cost]="city.minimumCostsWithRent" [currencyCode]="city.currencyCode"></wa-cost-fact></li>
            <li>Usual: <wa-cost-fact [cost]="city.costsWithRent" [currencyCode]="city.currencyCode"></wa-cost-fact></li>
            <li>Mortgage: <wa-cost-fact [cost]="city.costsWithMortgage" [currencyCode]="city.currencyCode"></wa-cost-fact></li>
          </ul>
        </td>
        <td>
          <ul>
            <li>Bare minimum: <wa-profit-desirable [profit]="city.bareMinimumSalary" [currencyCode]="city.currencyCode" /></li>
            <li>Sustainable: <wa-profit-desirable [profit]="city.sustainableSalary" [currencyCode]="city.currencyCode" /></li>
            <li>33K per year: <wa-profit-desirable [profit]="city.salaryToEarn1MlnUsdIn30Yrs" [currencyCode]="city.currencyCode" /></li>
          </ul>
        </td>

        <td>
          <ul>
            <li>Earn 1 mln USD: <wa-term-details [term]="city.millionaireTerm" [currencyCode]="city.currencyCode" /></li>
            <li>Earn mortgage down payment: <wa-term-details [term]="city.mortgageDownPaymentTerm" [currencyCode]="city.currencyCode" /></li>
            <li>Earn for new car: <wa-term-details [term]="city.buyCarTerm" [currencyCode]="city.currencyCode" /></li>
          </ul>
        </td>
      </tr>
      <tr>

      </tr>
    }
  </table>

</div>
